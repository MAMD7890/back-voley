# ğŸ—ï¸ ARQUITECTURA DEL SISTEMA - WOMPI + CLOUDFRONT + AWS

## ğŸ“Š Diagrama General de Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUARIO FINAL (Internet)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CloudFront   â”‚        â”‚    Wompi      â”‚
        â”‚   CDN/CORS     â”‚        â”‚   Dashboard   â”‚
        â”‚ d2ga9msb3312.. â”‚        â”‚   & API       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTPS
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   AWS CloudFront     â”‚
        â”‚   Distribution       â”‚
        â”‚  (cache + SSL)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP/HTTPS
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         AWS EC2 Instance                     â”‚
        â”‚         IP: 3.85.111.48:8080                 â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚   Nginx (Reverse Proxy)                â”‚  â”‚
        â”‚  â”‚   - Port 80 â†’ 8080                     â”‚  â”‚
        â”‚  â”‚   - Port 443 â†’ 8080 (con SSL)          â”‚  â”‚
        â”‚  â”‚   - CORS headers                       â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚           â”‚                                 â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚   Spring Boot Application            â”‚  â”‚
        â”‚  â”‚   Galacticos App Backend             â”‚  â”‚
        â”‚  â”‚   Java 17, Spring Security 6.x       â”‚  â”‚
        â”‚  â”‚                                       â”‚  â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
        â”‚  â”‚  â”‚ Controllers                     â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ AuthController                 â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ WompiController â­            â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ EstudianteController          â”‚ â”‚  â”‚
        â”‚  â”‚  â””â”€ ... (15+ controllers)         â”‚ â”‚  â”‚
        â”‚  â”‚                                     â”‚ â”‚  â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
        â”‚  â”‚  â”‚ Services                        â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ WompiService â­               â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ EstudianteService             â”‚ â”‚  â”‚
        â”‚  â”‚  â””â”€ ... (10+ services)            â”‚ â”‚  â”‚
        â”‚  â”‚                                     â”‚ â”‚  â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
        â”‚  â”‚  â”‚ Security                        â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ SecurityConfig                 â”‚ â”‚  â”‚
        â”‚  â”‚  â”œâ”€ JwtAuthenticationFilter        â”‚ â”‚  â”‚
        â”‚  â”‚  â””â”€ CustomUserDetailsService      â”‚ â”‚  â”‚
        â”‚  â”‚                                     â”‚ â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚           â”‚                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ (Internal DB Connection)
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   AWS RDS MySQL Database        â”‚
        â”‚   galacticos_db                 â”‚
        â”‚                                 â”‚
        â”‚   Tablas principales:           â”‚
        â”‚   â”œâ”€ usuario                    â”‚
        â”‚   â”œâ”€ estudiante                 â”‚
        â”‚   â”œâ”€ membresia                  â”‚
        â”‚   â”œâ”€ pago â­ (Wompi)            â”‚
        â”‚   â”œâ”€ profesor                   â”‚
        â”‚   â”œâ”€ equipo                     â”‚
        â”‚   â”œâ”€ asistencia_estudiante      â”‚
        â”‚   â””â”€ ... (13+ tablas)           â”‚
        â”‚                                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†“
                    â”‚ (Payment API Calls)
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Wompi Payment Gateway              â”‚
        â”‚   https://api.wompi.co               â”‚
        â”‚                                      â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚   â”‚ Production Credentials       â”‚  â”‚
        â”‚   â”œâ”€ pub_prod_xxxxx              â”‚  â”‚
        â”‚   â”œâ”€ prv_prod_xxxxx              â”‚  â”‚
        â”‚   â”œâ”€ prod_integrity_xxxxx        â”‚  â”‚
        â”‚   â””â”€ prod_events_xxxxx           â”‚  â”‚
        â”‚                                      â”‚
        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚   â”‚ Services                     â”‚  â”‚
        â”‚   â”œâ”€ generateIntegritySignature()â”‚  â”‚
        â”‚   â”œâ”€ createPaymentLink()         â”‚  â”‚
        â”‚   â”œâ”€ getTransactionStatus()      â”‚  â”‚
        â”‚   â””â”€ validateWebhook()           â”‚  â”‚
        â”‚                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Payment Card Networks              â”‚
        â”‚   (Visa, Mastercard, etc.)           â”‚
        â”‚   Via Wompi Processors               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Pago (Wompi)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FLUJO DE PAGO DETALLADO                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£  INICIACIÃ“N DE PAGO
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Usuario   â”‚
    â”‚  (Frontend) â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1. Click en "Pagar Cuota"
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST /api/wompi/create-payment   â”‚
    â”‚ {                               â”‚
    â”‚   "amount": 50000,              â”‚
    â”‚   "reference": "EST-123",       â”‚
    â”‚   "email": "test@test.com"      â”‚
    â”‚ }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend verifica:               â”‚
    â”‚  - Usuario autenticado           â”‚
    â”‚  - Monto vÃ¡lido                  â”‚
    â”‚  - Email vÃ¡lido                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

2ï¸âƒ£  OBTENER FIRMA DE INTEGRIDAD
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /api/wompi/integrity-sig?   â”‚
    â”‚ amount=50000                     â”‚
    â”‚ reference=EST-123                â”‚
    â”‚ currency=COP                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend:                        â”‚
    â”‚  1. Lee Wompi Private Key        â”‚
    â”‚  2. Calcula HMAC Signature:      â”‚
    â”‚     hmac(privateKey, data)       â”‚
    â”‚  3. Retorna:                     â”‚
    â”‚     - publicKey                  â”‚
    â”‚     - integritySignature         â”‚
    â”‚     - reference                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Response JSON:                  â”‚
    â”‚  {                               â”‚
    â”‚   "publicKey": "pub_prod_...",   â”‚
    â”‚   "integritySignature": "...",   â”‚
    â”‚   "reference": "EST-123"         â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

3ï¸âƒ£  ABRIR WIDGET DE WOMPI
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend:                       â”‚
    â”‚  1. Recibe datos del backend     â”‚
    â”‚  2. Carga script Wompi:          â”‚
    â”‚     <script src="wompi.co/w">    â”‚
    â”‚  3. Inicializa WidgetCheckout    â”‚
    â”‚  4. Abre widget con datos        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚   â”‚  WOMPI WIDGET - INGRESA TARJETA     â”‚   â”‚
    â”‚   â”‚                                      â”‚   â”‚
    â”‚   â”‚  NÃºmero de tarjeta: [______________]â”‚   â”‚
    â”‚   â”‚  ExpiraciÃ³n: [__________]           â”‚   â”‚
    â”‚   â”‚  CVV: [______]                      â”‚   â”‚
    â”‚   â”‚  Nombre: [__________________]       â”‚   â”‚
    â”‚   â”‚  Email: test@test.com (auto)        â”‚   â”‚
    â”‚   â”‚                                      â”‚   â”‚
    â”‚   â”‚            [PAGAR 50.000 COP]      â”‚   â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

4ï¸âƒ£  WOMPI PROCESA PAGO
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Wompi API:                      â”‚
    â”‚  1. Valida firma                 â”‚
    â”‚  2. Procesa tarjeta              â”‚
    â”‚  3. Comunica con red de pago     â”‚
    â”‚  4. Obtiene respuesta            â”‚
    â”‚  5. Guarda transacciÃ³n           â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚             â”‚              â”‚
        APROBADO    RECHAZADO      PENDIENTE
           â”‚             â”‚              â”‚
           â–¼             â–¼              â–¼

5ï¸âƒ£  WOMPI ENVÃA WEBHOOK
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Wompi â†’ Webhook Backend:        â”‚
    â”‚  POST /api/wompi/webhook         â”‚
    â”‚  {                               â”‚
    â”‚    "event": "transaction.update" â”‚
    â”‚    "data": {                     â”‚
    â”‚      "id": "wompi_id",           â”‚
    â”‚      "status": "APPROVED",       â”‚
    â”‚      "reference": "EST-123",     â”‚
    â”‚      "amount": 50000             â”‚
    â”‚    }                             â”‚
    â”‚  }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend valida:                 â”‚
    â”‚  1. Verifica firma webhook       â”‚
    â”‚  2. Confirma reference           â”‚
    â”‚  3. Actualiza BD:                â”‚
    â”‚     pago.estado = 'AL_DIA'       â”‚
    â”‚     estudiante.membresia UPDATE  â”‚
    â”‚  4. EnvÃ­a email confirmaciÃ³n     â”‚
    â”‚  5. Retorna 200 OK               â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼

6ï¸âƒ£  REDIRECCIÃ“N AL USUARIO
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend redirige a:            â”‚
    â”‚  /pago-exitoso?                  â”‚
    â”‚   reference=EST-123&             â”‚
    â”‚   status=APPROVED                â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  âœ… PAGO EXITOSO                 â”‚
    â”‚                                  â”‚
    â”‚  "Tu pago de 50.000 COP fue      â”‚
    â”‚   procesado exitosamente"        â”‚
    â”‚                                  â”‚
    â”‚  Referencia: EST-123             â”‚
    â”‚  Fecha: 2024-01-15               â”‚
    â”‚  Estado: APROBADO                â”‚
    â”‚                                  â”‚
    â”‚  [Descargar recibo] [Continuar]  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUJO DE SEGURIDAD                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. AUTENTICACIÃ“N (JWT)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Usuario â†’ POST /api/auth/login     â”‚
   â”‚ {                                  â”‚
   â”‚   "email": "user@test.com",        â”‚
   â”‚   "password": "secure123"          â”‚
   â”‚ }                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend:                           â”‚
   â”‚ 1. Valida credenciales en BD      â”‚
   â”‚ 2. Genera JWT token:              â”‚
   â”‚    header.payload.signature        â”‚
   â”‚    Secret: "MiClave...Segura..."  â”‚
   â”‚ 3. Retorna access_token           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend guarda token en:          â”‚
   â”‚ - localStorage                      â”‚
   â”‚ - sessionStorage                    â”‚
   â”‚ - HttpOnly Cookie (recomendado)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. AUTORIZACIÃ“N (Endpoints)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Cada request:                      â”‚
   â”‚ Authorization: Bearer {token}      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend JwtAuthenticationFilter:   â”‚
   â”‚ 1. Extrae token de header         â”‚
   â”‚ 2. Valida firma con secret        â”‚
   â”‚ 3. Verifica expiraciÃ³n            â”‚
   â”‚ 4. Autoriza endpoint              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€ VÃLIDO â†’ Procesar
            â”‚
            â””â”€ INVÃLIDO â†’ 401 Unauthorized

3. CORS (CloudFront)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Request desde CloudFront:          â”‚
   â”‚ Origin: https://d2ga9msb3312dv..  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Nginx verifica origen              â”‚
   â”‚ SecurityConfig valida              â”‚
   â”‚ Retorna headers CORS:              â”‚
   â”‚ Access-Control-Allow-Origin:       â”‚
   â”‚   https://d2ga9msb3312dv..        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. WOMPI SIGNATURE (HMAC)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend solicita firma:           â”‚
   â”‚ GET /wompi/integrity-signature     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend calcula HMAC:              â”‚
   â”‚ signature = HMAC_SHA256(           â”‚
   â”‚   key=privateKey,                  â”‚
   â”‚   message=amount|reference|cur     â”‚
   â”‚ )                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frontend envÃ­a a Wompi:            â”‚
   â”‚ {                                  â”‚
   â”‚   "publicKey": "pub_prod_...",     â”‚
   â”‚   "integritySignature": "...",     â”‚
   â”‚   "amount": 50000,                 â”‚
   â”‚   "reference": "EST-123",          â”‚
   â”‚   "currency": "COP"                â”‚
   â”‚ }                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Wompi valida:                      â”‚
   â”‚ - Firma HMAC correcta              â”‚
   â”‚ - Public key vÃ¡lida                â”‚
   â”‚ - Monto dentro de lÃ­mites          â”‚
   â”‚ - Reference Ãºnica                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. WEBHOOK VALIDATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Wompi â†’ POST /api/wompi/webhook    â”‚
   â”‚ Header: X-Wompi-Signature: ...     â”‚
   â”‚ Body: {transacciÃ³n}                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Backend valida:                    â”‚
   â”‚ 1. Extrae firma del header        â”‚
   â”‚ 2. Calcula HMAC con events_secret â”‚
   â”‚ 3. Compara con firma en header    â”‚
   â”‚ 4. Si coincide â†’ procesar         â”‚
   â”‚ 5. Si no â†’ rechazar (401)         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ ComunicaciÃ³n entre Componentes

```
COMPONENTE               MÃ‰TODO              PROTOCOLO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frontend â†” CloudFront   HTTPS               TLS 1.3
CloudFront â†” EC2        HTTP/HTTPS          Proxy inverso
EC2/App â†” RDS          TCP/IP              Intranet AWS
App â†” Wompi API        HTTPS/REST          TLS 1.3
Wompi â†” App Webhook    HTTP/HTTPS POST     TLS 1.3
App â†’ Email/SMS        SMTP/API            Twilio
```

---

## ğŸ¯ URLs y Endpoints Principales

```
FRONTEND
â”œâ”€â”€ Login: https://d2ga9msb3312dv.cloudfront.net/auth/login
â”œâ”€â”€ Dashboard: https://d2ga9msb3312dv.cloudfront.net/dashboard
â”œâ”€â”€ Pago: https://d2ga9msb3312dv.cloudfront.net/pagar
â””â”€â”€ Ã‰xito: https://d2ga9msb3312dv.cloudfront.net/pago-exitoso

BACKEND (API)
â”œâ”€â”€ AutenticaciÃ³n
â”‚   â”œâ”€â”€ POST /api/auth/login
â”‚   â”œâ”€â”€ POST /api/auth/register
â”‚   â””â”€â”€ POST /api/auth/refresh-token
â”œâ”€â”€ Wompi
â”‚   â”œâ”€â”€ GET  /api/wompi/integrity-signature
â”‚   â”œâ”€â”€ POST /api/wompi/create-payment-link
â”‚   â”œâ”€â”€ GET  /api/wompi/transaction/{id}
â”‚   â””â”€â”€ POST /api/wompi/webhook
â”œâ”€â”€ Estudiantes
â”‚   â”œâ”€â”€ GET    /api/estudiantes
â”‚   â”œâ”€â”€ POST   /api/estudiantes
â”‚   â”œâ”€â”€ GET    /api/estudiantes/{id}
â”‚   â”œâ”€â”€ PUT    /api/estudiantes/{id}
â”‚   â””â”€â”€ DELETE /api/estudiantes/{id}
â””â”€â”€ MembresÃ­as
    â”œâ”€â”€ GET    /api/membresias
    â”œâ”€â”€ POST   /api/membresias
    â””â”€â”€ GET    /api/membresias/{id}

WOMPI (EXTERNO)
â”œâ”€â”€ API: https://api.wompi.co
â”œâ”€â”€ Widget: https://checkout.wompi.co/widget.js
â””â”€â”€ Dashboard: https://dashboard.wompi.co

AWS SERVICES
â”œâ”€â”€ EC2: 3.85.111.48:8080 (HTTP)
â”œâ”€â”€ RDS: galacticos-db.xxxxx.rds.amazonaws.com:3306
â”œâ”€â”€ CloudFront: d2ga9msb3312dv.cloudfront.net
â””â”€â”€ S3: galacticos-frontend-bucket
```

---

## ğŸ’¾ Base de Datos - Tabla de Pagos

```sql
CREATE TABLE pago (
  id_pago INT PRIMARY KEY AUTO_INCREMENT,
  id_estudiante INT NOT NULL,
  id_membresia INT,
  
  -- Wompi Transaction
  wompi_transaction_id VARCHAR(255) UNIQUE,
  wompi_reference VARCHAR(140) UNIQUE,
  
  -- Monto
  monto_centavos INT NOT NULL,  -- 50000 = 500 COP
  moneda VARCHAR(3) DEFAULT 'COP',
  
  -- Estado
  estado ENUM(
    'PENDIENTE',      -- Esperando pago
    'INICIADO',       -- Widget abierto
    'COMPLETADO',     -- Wompi procesÃ³
    'APROBADO',       -- Pago exitoso
    'RECHAZADO',      -- Tarjeta rechazada
    'ANULADO'         -- Usuario cancelÃ³
  ) DEFAULT 'PENDIENTE',
  
  -- Detalles Wompi
  wompi_status VARCHAR(50),
  wompi_response JSON,
  
  -- Webhook
  webhook_recibido BOOLEAN DEFAULT FALSE,
  fecha_webhook TIMESTAMP,
  
  -- AuditorÃ­a
  fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (id_estudiante) REFERENCES estudiante(id_estudiante),
  FOREIGN KEY (id_membresia) REFERENCES membresia(id_membresia)
);
```

---

## ğŸš€ ConfiguraciÃ³n de ProducciÃ³n

```
COMPONENTE          CONFIG                  VALOR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Java                JAVA_HOME              /usr/lib/jvm/java-17
                    JAVA_OPTS              -Xmx1g -Xms512m
                    
Spring Boot         spring.profiles.active  prod
                    server.port             8080
                    server.servlet.context-path  /
                    
JWT                 jwt.secret              [32+ caracteres]
                    jwt.expiration          86400000 (24h)
                    
Wompi               wompi.sandbox           false (PRODUCCIÃ“N)
                    wompi.public-key        pub_prod_*
                    wompi.private-key       prv_prod_*
                    wompi.api-url           https://api.wompi.co
                    
Database            spring.datasource.url   jdbc:mysql://rds-host:3306/galacticos_db
                    spring.jpa.hibernate.ddl-auto  validate (NO update)
                    
Logging             logging.level.root      INFO
                    logging.level.app       DEBUG
                    logging.file.name       /var/log/galacticos/app.log
                    
Nginx               listen                  80, 443
                    server_name             3.85.111.48 (o dominio)
                    proxy_pass              http://localhost:8080
                    ssl_certificate         /etc/ssl/cert.pem
                    
AWS CloudFront      distribution-id         E123ABC456XYZ
                    origin                  3.85.111.48:8080
                    cache-policy            Managed-CachingOptimized
                    cors-policy             AllowAllOrigins
```

---

**Arquitectura VersiÃ³n:** 2.0 | **Ãšltima actualizaciÃ³n:** 2024 | **Estado:** âœ… PRODUCCIÃ“N

